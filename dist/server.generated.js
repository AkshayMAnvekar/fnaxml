module.exports=function(e){var t={};function r(o){if(t[o])return t[o].exports;var i=t[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,o){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(r.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(o,i,function(t){return e[t]}.bind(null,i));return o},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/dist/",r(r.s=5)}([function(e,t){e.exports=require("xlsx")},function(e,t){e.exports=require("fs")},function(e,t){e.exports=require("path")},function(e,t){e.exports=require("excel4node")},function(e,t){e.exports=require("string-similarity")},function(e,t,r){r(6),e.exports=r(7)},function(e,t){e.exports=require("babel-polyfill")},function(e,t,r){const o=r(8),i=r(2),l=r(9),n=(r(10),r(0),r(11)),a=(r(1),r(12));var s=n.memoryStorage(),c=n({storage:s}).single("myFile");const u=o();u.use(l.urlencoded({extended:!1})),u.use(l.json());const p=process.cwd();u.use(o.static(i.join(p,"public"))),u.get("/test",(e,t)=>{t.send("My page")}),u.get("/test1",(e,t)=>{t.send("My page 2")}),u.get("/getfile1",(e,t)=>{console.log(e.query),t.send("My page 2")}),u.post("/getfile",(e,t)=>{c(e,t,(async function(r){if(r)return t.end("Error uploading file.");console.log("MyFunction Call"),console.log("File Writer Call"),console.log("File Writer Close");var o=await a(e.file.buffer);return console.log("Result",o),t.download(o)}))}),u.get("*",(e,t)=>{t.send("My web page")});const d=process.env.PORT||3e3;u.listen(d)},function(e,t){e.exports=require("express")},function(e,t){e.exports=require("body-parser")},function(e,t){e.exports=require("formidable")},function(e,t){e.exports=require("multer")},function(e,t,r){const o=r(1),i=r(13),l=(r(3),r(14)),n=(r(15),r(0)),a=(r(4),r(16)),s=r(2);var c=2;async function u(e){return new Promise(t=>setTimeout(t,e))}async function p(e,t){console.log("Extracted read Start");var r=n.readFile("./Output/Extracted.xlsx");console.log("Extracted read End");var l=r.Sheets["Extracted Data"],a=new i.Parser;o.readFile(e,(async function(e,t){a.parseString(t,(async function(e,t){let i=JSON.stringify(t,null,2);o.writeFileSync("./Output/xml.json",i),o.writeFileSync("./Output/xml.txt",t),t.questionSet.question.forEach((async function(e){if("SB"!=e.type.toString()){var t={LO:"",topic:"",AACSB:"",BB:"",FN:"",blooms:"",difficulty:"",time:"",type:"",gradable:""};t.qtype=e.type.toString(),t.LODescription="",t.title=e.title.toString(),t.EA=" ";var r=e.questionProperties[0];for(individualProperty of(console.log(t.title),r.property))if("customType"===individualProperty.$.name&&""!=individualProperty.$.value&&(t.qtype=individualProperty.$.value),"WK"===e.type.toString()){var o=e.worksheet[0].answers,i=o[0].externalAnswer;if("object"==typeof o[0].essayAnswer&&(t.EA="True"),"object"==typeof i)for(indAnsProperty of i[0].answerProperties[0].property)"customType"===indAnsProperty.$.name&&""!=indAnsProperty.$.value&&(t.qtype=indAnsProperty.$.value)}e.categories.forEach((function(e){e.internal_category.forEach((function(e){var r=e.title.toString();r.includes("Learning Objective:")&&(""!==t.LO&&(t.LO+=", "),t.LO+=r.replace(/(.*)(\d{2,3})(-)(\d{2,3})(.*)/g,"$2$3$4")),r.includes("Learning Objective:")&&(""!==t.LODescription&&(t.LODescription+=";"),t.LODescription+=r.replace(/(.*)(\d{2,3})(-)(\d{2,3})(.*)/g,"$2$3$4 $5")),r.includes("Topic:")&&(""!==t.topic&&(t.topic+=", "),t.topic+=r.replace(/Topic: /g,"")),r.includes("AACSB:")&&(""!==t.AACSB&&(t.AACSB+=", "),t.AACSB+=r.replace(/AACSB: /g,"")),r.includes("AICPA: BB")&&(""!==t.BB&&(t.BB+=", "),t.BB+=r.replace(/AICPA: BB /g,"")),r.includes("AICPA: FN")&&(""!==t.FN&&(t.FN+=", "),t.FN+=r.replace(/AICPA: FN /g,"")),r.includes("Blooms:")&&(""!==t.blooms&&(t.blooms+=", "),t.blooms+=r.replace(/Blooms: /g,"")),r.includes("Difficulty:")&&(""!==t.difficulty&&(t.difficulty+=", "),t.difficulty+=r.replace(/Difficulty: /g,"")),r.includes("Est Time:")&&(""!==t.time&&(t.time+=", "),t.time+=r.replace(/Est Time: /g,"")),r.includes("Type:")&&(""!==t.type&&(t.type+=", "),t.type+=r.replace(/Type: /g,"")),r.includes("Gradable:")&&(""!==t.gradable&&(t.gradable+=", "),t.gradable+=r.replace(/Gradable: /g,""))}))}));var a=[[`${t.title}`,`${t.LO}`,`${t.topic}`,`${t.AACSB}`,`${t.BB}`,`${t.FN}`,`${t.blooms}`,`${t.difficulty}`,`${t.time}`,`${t.type}`,`${t.qtype}`,`${t.gradable}`,`${t.LODescription}`,`${t.EA}`]];n.utils.sheet_add_aoa(l,a,{origin:`A${c}`}),c++}})),await n.writeFileSync(r,"./Output/Extracted.xlsx"),await u(2e3),console.log("Done")}))})),t("./Comparison.xlsx")}e.exports=async function(e){await async function(){o.readdir("./Temp",(e,t)=>{if(e)throw e;for(const e of t)o.unlink(s.join("./Temp",e),e=>{if(e)throw e})}),o.readdir("./Output",(e,t)=>{if(e)throw e;for(const e of t)o.unlink(s.join("./Output",e),e=>{if(e)throw e})})}(),await u(2e3),console.log("Opening Zip File");var t=new l(e),r=t.getEntries();console.log("Parsing Zip File"),t.extractAllTo("./Temp/",!0);var i=n.readFile("ExcelTemplate.xlsx");for await(var c of(await n.writeFileSync(i,"./Output/Extracted.xlsx"),r)){if(await u(2e3),console.log(c.entryName),"xlsx"==c.entryName.split(".").pop()){var d=n.readFile("./Temp/"+c.entryName),f=d.SheetNames[0],g=d.Sheets[f],y=n.readFile("./Output/Extracted.xlsx");n.utils.book_append_sheet(y,g,f);var m=d.SheetNames[1],v=d.Sheets[m];await n.writeFileSync(y,"./Output/Extracted.xlsx");y=n.readFile("./Output/Extracted.xlsx");n.utils.book_append_sheet(y,v,m);let e=JSON.stringify(n.utils.sheet_to_json(g),null,2);o.writeFileSync("./Output/PM.json",e),await n.writeFileSync(y,"./Output/Extracted.xlsx")}"xml"==c.entryName.split(".").pop()&&await p("./Temp/"+c.entryName,(function(e){console.log("XML",e)}))}await u(4e3),console.log("Compare Start"),await a("./Output/Extracted.xlsx"),console.log("Compare End"),await u(2e3);var x=new l;return x.addLocalFile("./Output/Comparison.xlsx"),x.addLocalFile("./Output/Extracted.xlsx"),x.writeZip("./Output/Output.zip"),await u(2e3),"./Output/Output.zip"}},function(e,t){e.exports=require("xml2js")},function(e,t){e.exports=require("adm-zip")},function(e,t){e.exports=require("exceljs")},function(e,t,r){const o=r(0),i=r(4),l=(r(1),r(3));function n(e){var t=e.split(" ");return t[t.length-1]}function a(e){return/\d/g.test(e)}function s(e,t){var r={};t=(t=t.replace(/  +/g,",")).replace("\r\n",","),e=e.trim(),t=t.trim();var o=e.split(/[,;]/g).sort(),l=t.split(/[,;]/g).sort();o=o.filter(Boolean),l=l.filter(Boolean);for(var n=0;n<o.length;n++)o[n]=o[n].trim();for(n=0;n<l.length;n++)l[n]=l[n].trim();return o=o.sort(),l=l.sort(),r.extract=o.toString(),r.PM=l.toString(),r.Result=i.compareTwoStrings(o.toString(),l.toString()),r}function u(e,t){var r=e,o=t;return console.log(r,o),s(r,o)}function p(e,t){return s(e,t)}function f(e,t){return s(e,t)}function g(e,t){return s(e,t)}function y(e,t){return s(e,t)}function m(e,t){var r=e.toUpperCase(),o=t.toUpperCase(),i={};return i.extract=r,i.PM=o,i.Result=1,""===r&&(i.Result=0),r.includes("ESSAY")&&o.includes("AUTO")&&(i.Result=0),!r.includes("ESSAY")&&o.includes("MANUAL")&&(i.Result=.975),i}function v(e,t){var r=e.charAt(0);r=r.toUpperCase();var o=t.toUpperCase(),i={};return i.extract=r,i.PM=o,i.Result=0,"B"===o?"S"!==r&&"A"!==r||(i.Result=1):r===o&&(i.Result=1),i}function x(e,t){var r=e,o=t;return a(r)&&(r=n(r)),a(o)&&(o=n(o)),s(r,o)}function h(e,t){var r=e,o={extract:"",PM:"",Result:0};if(e.includes(";")){var i=r.split(/[;]/g).sort();for(var l of i){for(var n of t){c=l,d=n.LODescription;var a=c.match(/(\d{1,2}-\d{1,3})/),u=d.match(/(\d{1,2}-\d{1,3})/g);if(a[0].replace(/\b0+/g,"")===u[0].replace(/\b0+/g,"")){var p=l.replace(/(\d{1,2}-\d{1,3})(.*)/g,"$2"),f=n.LODescription.replace(/\s{2,}/g," ");f=f.replace(/(.*)(\d{1,2}-\d{1,3})(.*)/g,"$3");var g=s(p.trim(),f.trim());""!==o.extract&&(o.extract+=", "),""!==o.PM&&(o.PM+=", "),o.extract+=g.extract,o.PM+=g.PM,o.Result=o.Result+g.Result}}o.Result>1&&(o.Result=o.Result/2)}}else for(var n of t){var y=e.match(/(\d{1,2}-\d{1,3})/),m=n.LODescription.match(/(\d{1,2}-\d{1,3})/g);if(y[0].replace(/\b0+/g,"")===m[0].replace(/\b0+/g,"")){var v=e.replace(/(\d{1,2}-\d{1,3})(.*)/g,"$2"),x=n.LODescription.replace(/\s{2,}/g," ");x=x.replace(/(.*)(\d{1,2}-\d{1,3})(.*)/g,"$3"),o=s(v.trim(),x.trim())}}return o}function $(e,t){var r=e,o=t;return a(r)&&(r=n(r)),a(o)&&(o=n(o)),s(r,o)}function B(e,t){var r=e.match(/(\d{1,3})/g),o=t.match(/(\d{1,3})/g),i={};return i.extract=e,i.PM=t,null!=r&&null!=o&&(r.length>1&&o.length>1?r[r.length-1]===o[o.length-1]&&r[0]===o[0]?i.Result=1:i.Result=0:i.Result=parseInt(r[r.length-1])===parseInt(o[o.length-1])?1:0),i}e.exports=async function(e){var t=new l.Workbook,r=t.createStyle({font:{color:"#000000",size:12},numberFormat:"$#,##0.00; ($#,##0.00); -"}),i=t.createStyle({font:{bold:!0,color:"#000000",size:12},fill:{type:"pattern",patternType:"solid",fgColor:"#00B8FF"},numberFormat:"$#,##0.00; ($#,##0.00); -"}),n=t.createStyle({font:{color:"#000000",size:12},fill:{type:"pattern",patternType:"solid",fgColor:"#FF0000"},numberFormat:"$#,##0.00; ($#,##0.00); -"}),a=t.createStyle({font:{color:"#000000",size:12},fill:{type:"pattern",patternType:"solid",fgColor:"#FFA500"},numberFormat:"$#,##0.00; ($#,##0.00); -"}),c=t.addWorksheet("Comparison Result",{sheetFormat:{defaultColWidth:30}});c.cell(1,1).string("Question").style(i),c.cell(1,2).string("LO").style(i),c.cell(1,3).string("Topic").style(i),c.cell(1,4).string("AACSB").style(i),c.cell(1,5).string("BB").style(i),c.cell(1,6).string("FN").style(i),c.cell(1,7).string("Blooms").style(i),c.cell(1,8).string("Difficulty").style(i),c.cell(1,9).string("Time").style(i),c.cell(1,10).string("Type").style(i),c.cell(1,11).string("Worksheet").style(i),c.cell(1,12).string("Gradable").style(i),c.cell(1,13).string("LODescription").style(i);var d=o.readFile("./Output/Extracted.xlsx"),S=d.Sheets["Extracted Data"],b=o.utils.sheet_to_json(S),O=d.Sheets.Sheet1,A=d.Sheets.Sheet2,T=o.utils.sheet_to_json(O),M=o.utils.sheet_to_json(A);console.log(M);var P,R,D,F,w=2;for(let e of b){e.Q=e.Q.replace(/\[(.*)\]/g,"");var E=e.Q.match(/(\d{1,2}-\d{1,3})/);null!==E&&(E[0]=E[0].replace(/\b0+/g,""));for(let t of T){var C=t.Q.match(/(\d{1,2}-\d{1,3})/g);if(null!==E&&(C[0]=C[0].replace(/\b0+/g,"")),null!==E&&E[0]===C[0]){if(console.log("Test",E[0],C),c.cell(w,1).string(`Extracted Q Title:${e.Q}\r\nProblem Map Q Title:${t.Q}`).style(r),void 0!==e.LO&&e.LO||(e.LO="99-99"),void 0!==t.LO&&t.LO||(t.LO="99-99"),void 0!==e.LO&&void 0!==t.LO){var L=(P=e.LO,R=t.LO,D=void 0,F=void 0,D=P.match(/(\d{1,2}-\d{1,3})/g),F=R.match(/(\d{1,2}-\d{1,3})/g),s(D.toString(),F.toString()));c.cell(w,2).string(`Extracted Data: ${L.extract}\r\nProblem Map Data: ${L.PM}\r\nMatch: ${L.Result}`).style(1===L.Result?r:L.Result>=.95?a:n)}if(void 0!==e.Topic&&e.Topic||(e.Topic=""),void 0!==t.Topic&&t.Topic||(t.Topic=""),void 0!==e.Topic&&void 0!==t.Topic){var N=u(e.Topic,t.Topic);c.cell(w,3).string(`Extracted Data: ${N.extract}\r\nProblem Map Data: ${N.PM}\r\nMatch: ${N.Result}`).style(1===N.Result?r:N.Result>=.95?a:n)}if(void 0!==e.AACSB&&e.AACSB||(e.AACSB=""),void 0!==t.AACSB&&t.AACSB||(t.AACSB=""),void 0!==e.AACSB&&void 0!==t.AACSB){var k=p(e.AACSB,t.AACSB);c.cell(w,4).string(`Extracted Data: ${k.extract}\r\nProblem Map Data: ${k.PM}\r\nMatch: ${k.Result}`).style(1===k.Result?r:k.Result>=.95?a:n)}if(void 0!==e.BB&&e.BB||(e.BB=""),void 0!==t.BB&&t.BB||(t.BB=""),void 0!==e.BB&&void 0!==t.BB){var j=f(e.BB,t.BB);c.cell(w,5).string(`Extracted Data: ${j.extract}\r\nProblem Map Data: ${j.PM}\r\nMatch: ${j.Result}`).style(1===j.Result?r:j.Result>=.95?a:n)}if(void 0!==e.FN&&e.FN||(e.FN=""),void 0!==t.FN&&t.FN||(t.FN=""),void 0!==e.FN&&void 0!==t.FN){var W=g(e.FN,t.FN);c.cell(w,6).string(`Extracted Data: ${W.extract}\r\nProblem Map Data: ${W.PM}\r\nMatch: ${W.Result}`).style(1===W.Result?r:W.Result>=.95?a:n)}if(void 0!==e.Blooms&&e.Blooms||(e.Blooms=""),void 0!==t.Blooms&&t.Blooms||(t.Blooms=""),void 0!==e.Blooms&&void 0!==t.Blooms){var q=x(e.Blooms,t.Blooms);c.cell(w,7).string(`Extracted Data: ${q.extract}\r\nProblem Map Data: ${q.PM}\r\nMatch: ${q.Result}`).style(1===q.Result?r:q.Result>=.95?a:n)}if(void 0!==e.Difficulty&&e.Difficulty||(e.Difficulty=""),void 0!==t.Difficulty&&t.Difficulty||(t.Difficulty=""),void 0!==e.Difficulty&&void 0!==t.Difficulty){var _=$(e.Difficulty,t.Difficulty);c.cell(w,8).string(`Extracted Data: ${_.extract}\r\nProblem Map Data: ${_.PM}\r\nMatch: ${_.Result}`).style(1===_.Result?r:_.Result>=.95?a:n)}if(void 0!==e.Time&&e.Time||(e.Time="99"),void 0!==t.Time&&t.Time||(t.Time="99"),void 0!==e.Time&&void 0!==t.Time){var Q=B(e.Time,t.Time);c.cell(w,9).string(`Extracted Data: ${Q.extract}\r\nProblem Map Data: ${Q.PM}\r\nMatch: ${Q.Result}`).style(1===Q.Result?r:Q.Result>=.95?a:n)}if(void 0!==e.Type&&e.Type||(e.Type=""),void 0!==t.Type&&t.Type||(t.Type=""),void 0!==e.Type&&void 0!==t.Type){var G=v(e.Type,t.Type);c.cell(w,10).string(`Extracted Data: ${G.extract}\r\nProblem Map Data: ${G.PM}\r\nMatch: ${G.Result}`).style(1===G.Result?r:G.Result>=.95?a:n)}if(void 0!==e.Worksheet&&e.Worksheet||(e.Worksheet=""),void 0!==t.Worksheet&&t.Worksheet||(t.Worksheet=""),void 0!==e.Worksheet&&void 0!==t.Worksheet){var z=y(e.Worksheet,t.Worksheet);c.cell(w,11).string(`Extracted Data: ${z.extract}\r\nProblem Map Data: ${z.PM}\r\nMatch: ${z.Result}`).style(1===z.Result?r:z.Result>=.95?a:n)}if(void 0!==e.Gradable&&e.Gradable||(e.Gradable=""),void 0!==t.Worksheet&&t.Worksheet||(t.Worksheet=""),void 0!==e.Gradable&&void 0!==t.Worksheet){var I=m(e.Gradable,t.Worksheet);c.cell(w,12).string(`Extracted Data: ${I.extract}\r\nProblem Map Data: ${I.PM}\r\nMatch: ${I.Result}`).style(1===I.Result?r:I.Result>=.95?a:n)}if(void 0!==e.LODescription&&e.LODescription||(e.LODescription="99-99"),void 0!==e.LODescription&&void 0!==M){var U=h(e.LODescription,M);c.cell(w,13).string(`Extracted Data: ${U.extract}\r\nProblem Map Data: ${U.PM}\r\nMatch: ${U.Result}`).style(1===U.Result?r:U.Result>=.95?a:n)}}}w++}console.log("Comparison write Start"),t.write("./Output/Comparison.xlsx"),console.log("Comparison write End")}}]);